<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Boussole WebApp</title>
</head>
<body>

<label for="lieu">Lieu :</label>
<input id="lieu" type="text" placeholder="Ex : Paris" />

<p>Azimut corrigé : <span id="azimut">--°</span></p>

<button id="startBtn">Autoriser l'accès aux capteurs</button>

<div id="message"></div>

<script>
  const lieuInput = document.getElementById('lieu');
  const azimutSpan = document.getElementById('azimut');
  const messageDiv = document.getElementById('message');
  const startBtn = document.getElementById('startBtn');

  let azimutCorrige = 0;

  // Simule lecture azimut (remplace par ta fonction réelle)
  function simulateAzimut() {
    azimutCorrige = Math.floor(Math.random() * 360);
    azimutSpan.textContent = azimutCorrige + "°";
  }

  function sendAzimut() {
    const lieu = lieuInput.value.trim();
    if (!lieu) {
      messageDiv.style.color = 'red';
      messageDiv.textContent = "Merci de renseigner un lieu.";
      return;
    }
    messageDiv.style.color = 'black';
    messageDiv.textContent = "Envoi en cours…";

    fetch('https://emercier.synology.me/insert_azimuth_iphone.php', {
      method: 'POST',
      headers: {'Content-Type': 'application/x-www-form-urlencoded'},
      body: `azimuth=${azimutCorrige}&lieu=${encodeURIComponent(lieu)}`
    })
    .then(response => response.text())
    .then(data => {
      messageDiv.style.color = 'green';
      messageDiv.textContent = "Réponse serveur : " + data;
    })
    .catch(error => {
      messageDiv.style.color = 'red';
      messageDiv.textContent = "Erreur d'envoi : " + error;
    });
  }

  // Exemple simple : envoie toutes les 10 sec après clic bouton
  startBtn.addEventListener('click', () => {
    simulateAzimut(); // pour test
    sendAzimut();
    setInterval(() => {
      simulateAzimut();
      sendAzimut();
    }, 10000);
    startBtn.disabled = true;
  });
</script>

</body>
</html>
